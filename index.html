<!DOCTYPE html>
<head>
            <meta charset="utf-8" />
<script>(function(i,s,o,g,r,a,m){i["GoogleAnalyticsObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,"script","https://www.google-analytics.com/analytics.js","ga");ga("create", "UA-105319773-1", {"cookieDomain":"auto"});ga("set", "anonymizeIp", true);ga("send", "pageview");</script>

    <title>Ballot Manager</title>
    <link rel="stylesheet" type="text/css" href="main.css">
	<link href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.19/css/jquery.dataTables.css">
	<script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/gh/ethereum/web3.js@1.0.0-beta.34/dist/web3.js"></script>
	<script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.js"></script>
</head>
<body>
    <div class="container">

        <h1>Ballot Manager</h1>

    	<div class="panel panel-default">
        	<div class="panel-heading">New Ballot Contract</div>
        	<div class="panel-body">       
            	<div class="form-group">
        			<label for="official">Ballot Official Name</label>
        			<input id="official" class="form-control" type="text" value="Chairman">
            	</div>
            	<div class="form-group">
        			<label for="proposal">Proposal</label>
        			<input id="proposal" class="form-control" type="text" value="Should we re-elect Jack?">
            	</div>
            	<div class="form-group">
                	<input id="btnGo" class="btn btn-primary" type="button" value="Go" />
                	<img id="loader" src="https://loading.io/spinners/reload/index.ajax-syncing-loading-icon.svg">
            	</div>
        	</div>
    	</div>

        <div class="panel panel-default">
        	<div class="panel-heading">Contract Details</div>
        	<div class="panel-body"> 
        		<div id="contractaddress"></div>
        		<div id="itemvalue"></div>
        		<div id="seller"></div>
                <div id="buyer"></div>
                <div id="ipfshash"></div>
                <div id="ipfsimage"></div>
                <div id="state"></div>
        	</div>
    	</div>    
    
    </div>

    <script>
        var web3 = new Web3();
        var accountaddress;
        var ballotContract;
        var ballotByteCode;
        var ballot;
        
        window.addEventListener('load', async () => {
            // Modern dapp browsers...
        	if (window.ethereum) {
        	    window.web3 = new Web3(ethereum);
        		try {
        			// Request account access if needed
        			await ethereum.enable();
        			// Acccounts now exposed
        			accountaddress = web3.givenProvider.selectedAddress;
                    ballotContract = new web3.eth.Contract([ { "constant": false, "inputs": [], "name": "countVote", "outputs": [ { "name": "totalVotes", "type": "uint256" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": false, "inputs": [], "name": "startVote", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "totalVoter", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "proposal", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_choice", "type": "bool" } ], "name": "doVote", "outputs": [ { "name": "voted", "type": "bool" } ], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "ballotOfficialAddress", "outputs": [ { "name": "", "type": "address" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "countResult", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [ { "name": "", "type": "address" } ], "name": "voterRegister", "outputs": [ { "name": "voterName", "type": "string" }, { "name": "voted", "type": "bool" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "state", "outputs": [ { "name": "", "type": "uint8" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": false, "inputs": [ { "name": "_voterAddress", "type": "address" }, { "name": "_voterName", "type": "string" } ], "name": "addVoter", "outputs": [], "payable": false, "stateMutability": "nonpayable", "type": "function" }, { "constant": true, "inputs": [], "name": "ballotOfficialName", "outputs": [ { "name": "", "type": "string" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "constant": true, "inputs": [], "name": "totalVote", "outputs": [ { "name": "", "type": "uint256" } ], "payable": false, "stateMutability": "view", "type": "function" }, { "inputs": [ { "name": "_ballotOfficialName", "type": "string" }, { "name": "_proposal", "type": "string" } ], "payable": false, "stateMutability": "nonpayable", "type": "constructor" }, { "anonymous": false, "inputs": [], "name": "voterAdded", "type": "event" }, { "anonymous": false, "inputs": [], "name": "voteStarted", "type": "event" }, { "anonymous": false, "inputs": [], "name": "voteCounted", "type": "event" }, { "anonymous": false, "inputs": [], "name": "voteDone", "type": "event" }, { "anonymous": false, "inputs": [ { "indexed": false, "name": "contractAddress", "type": "address" } ], "name": "contractCreated", "type": "event" } ]);
                    ballotByteCode = '608060405260008055600060015560006002553480156200001f57600080fd5b506040516200116c3803806200116c833981018060405260408110156200004557600080fd5b8101908080516401000000008111156200005e57600080fd5b828101905060208101848111156200007557600080fd5b81518560018202830111640100000000821117156200009357600080fd5b50509291906020018051640100000000811115620000b057600080fd5b82810190506020810184811115620000c757600080fd5b8151856001820283011164010000000082111715620000e557600080fd5b505092919050505033600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff160217905550816004908051906020019062000146929190620001f0565b5080600590805190602001906200015f929190620001f0565b507ffcf9a0c9dedbfcd1a047374855fc36baaf605bd4f4837802a0cc938ba1b5f30230604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390a16000600860006101000a81548160ff02191690836002811115620001e357fe5b021790555050506200029f565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106200023357805160ff191683800117855562000264565b8280016001018555821562000264579182015b828111156200026357825182559160200191906001019062000246565b5b50905062000273919062000277565b5090565b6200029c91905b80821115620002985760008160009055506001016200027e565b5090565b90565b610ebd80620002af6000396000f3fe6080604052600436106100b4576000357c0100000000000000000000000000000000000000000000000000000000900480631a6cd2fd146100b95780634c0a6af0146100e45780636332abc9146100fb578063753ec1031461012657806387caea78146101b6578063909497471461020b5780639e76e02214610262578063af1540871461028d578063c19d93fb14610362578063d9e95a981461039b578063de975d1814610483578063f1cea4c714610513575b600080fd5b3480156100c557600080fd5b506100ce61053e565b6040518082815260200191505060405180910390f35b3480156100f057600080fd5b506100f9610685565b005b34801561010757600080fd5b50610110610769565b6040518082815260200191505060405180910390f35b34801561013257600080fd5b5061013b61076f565b6040518080602001828103825283818151815260200191508051906020019080838360005b8381101561017b578082015181840152602081019050610160565b50505050905090810190601f1680156101a85780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b3480156101c257600080fd5b506101f1600480360360208110156101d957600080fd5b8101908080351515906020019092919050505061080d565b604051808215151515815260200191505060405180910390f35b34801561021757600080fd5b50610220610a7b565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34801561026e57600080fd5b50610277610aa1565b6040518082815260200191505060405180910390f35b34801561029957600080fd5b506102dc600480360360208110156102b057600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190505050610aa7565b604051808060200183151515158152602001828103825284818151815260200191508051906020019080838360005b8381101561032657808201518184015260208101905061030b565b50505050905090810190601f1680156103535780820380516001836020036101000a031916815260200191505b50935050505060405180910390f35b34801561036e57600080fd5b50610377610b70565b6040518082600281111561038757fe5b60ff16815260200191505060405180910390f35b3480156103a757600080fd5b50610481600480360360408110156103be57600080fd5b81019080803573ffffffffffffffffffffffffffffffffffffffff169060200190929190803590602001906401000000008111156103fb57600080fd5b82018360208201111561040d57600080fd5b8035906020019184600183028401116401000000008311171561042f57600080fd5b91908080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f820116905080830192505050505050509192919290505050610b83565b005b34801561048f57600080fd5b50610498610cfa565b6040518080602001828103825283818151815260200191508051906020019080838360005b838110156104d85780820151818401526020810190506104bd565b50505050905090810190601f1680156105055780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561051f57600080fd5b50610528610d98565b6040518082815260200191505060405180910390f35b6000600180600281111561054e57fe5b600860009054906101000a900460ff16600281111561056957fe5b14151561057557600080fd5b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156105d157600080fd5b60008090506002600860006101000a81548160ff021916908360028111156105f557fe5b021790555060008090505b600254811015610649576006600082815260200190815260200160002060000160149054906101000a900460ff161561063c5781806001019250505b8080600101915050610600565b50806000819055507fe604cb60647ea8ffb3d7e9f76475564c33edb7f26b8f2ce06b28cd0f9eca798760405160405180910390a1809250505090565b600080600281111561069357fe5b600860009054906101000a900460ff1660028111156106ae57fe5b1415156106ba57600080fd5b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561071657600080fd5b6001600860006101000a81548160ff0219169083600281111561073557fe5b02179055507fd0dc01800a369fef30d3fced5275b8b916549867622e79efca5245c479fda4ea60405160405180910390a150565b60015481565b60058054600181600116156101000203166002900480601f0160208091040260200160405190810160405280929190818152602001828054600181600116156101000203166002900480156108055780601f106107da57610100808354040283529160200191610805565b820191906000526020600020905b8154815290600101906020018083116107e857829003601f168201915b505050505081565b6000600180600281111561081d57fe5b600860009054906101000a900460ff16600281111561083857fe5b14151561084457600080fd5b60008090506000600760003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001805460018160011615610100020316600290049050141580156108fd5750600760003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160009054906101000a900460ff16155b15610a45576001600760003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060010160006101000a81548160ff021916908315150217905550610965610d9e565b33816000019073ffffffffffffffffffffffffffffffffffffffff16908173ffffffffffffffffffffffffffffffffffffffff1681525050848160200190151590811515815250508060066000600254815260200190815260200160002060008201518160000160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060208201518160000160146101000a81548160ff02191690831515021790555090505060026000815480929190600101919050555060019150505b7f5818873375c4a78b92c8c9beba372d76e098294505b2326e55dd2b4d8709145860405160405180910390a18092505050919050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b60005481565b6007602052806000526040600020600091509050806000018054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610b535780601f10610b2857610100808354040283529160200191610b53565b820191906000526020600020905b815481529060010190602001808311610b3657829003601f168201915b5050505050908060010160009054906101000a900460ff16905082565b600860009054906101000a900460ff1681565b6000806002811115610b9157fe5b600860009054906101000a900460ff166002811115610bac57fe5b141515610bb857600080fd5b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16141515610c1457600080fd5b610c1c610dd0565b828160000181905250600081602001901515908115158152505080600760008673ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206000820151816000019080519060200190610c92929190610dec565b5060208201518160010160006101000a81548160ff0219169083151502179055509050506001600081548092919060010191905055507fad4c51a1b9940725d3d190b2faee948ba1d8892448fa708e5c511cf65964ab4c60405160405180910390a150505050565b60048054600181600116156101000203166002900480601f016020809104026020016040519081016040528092919081815260200182805460018160011615610100020316600290048015610d905780601f10610d6557610100808354040283529160200191610d90565b820191906000526020600020905b815481529060010190602001808311610d7357829003601f168201915b505050505081565b60025481565b6040805190810160405280600073ffffffffffffffffffffffffffffffffffffffff1681526020016000151581525090565b6040805190810160405280606081526020016000151581525090565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10610e2d57805160ff1916838001178555610e5b565b82800160010185558215610e5b579182015b82811115610e5a578251825591602001919060010190610e3f565b5b509050610e689190610e6c565b5090565b610e8e91905b80821115610e8a576000816000905550600101610e72565b5090565b9056fea165627a7a72305820fb562e9e89ece08dba1c5d37017b4bfdc7a9fe79f9318c133dd614a476173bdb0029';
        			//web3.eth.sendTransaction({/* ... */});
        		} catch (error) {
        			// User denied account access...
        		}
        	}
        	// Legacy dapp browsers...
        	else if (window.web3) {
        			window.web3 = new Web3(web3.currentProvider);
        			// Acccounts always exposed
        			web3.eth.sendTransaction({/* ... */});
        	}
        	// Non-dapp browsers...
        	else {
        			console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
        	}
        });


        
        $("#btnGo").click(async function() {	
            $("#loader").show();
            var i = 0;
            var _ballotOfficialName = "Chairman";
            var _proposal = "Should Jackson";
            
            ballotContract.deploy({
                data: ballotByteCode,
                arguments: [_ballotOfficialName, _proposal],
            })
            .send({
                from: accountaddress,
                gas: 2700000, 
                gasPrice: web3.utils.toWei('20', 'gwei')
            }, (error, transactionHash) => { 
                console.log("a");
            })
            .on('error', (error) => { 
                console.log("b");            
            })
            .on('transactionHash', (transactionHash) => { 
                console.log("c");
            })
            .on('receipt', (receipt) => {
                console.log(receipt.contractAddress); // contains the new contract address
                $("#loader").hide();
            })
            .on('confirmation', (confirmationNumber, receipt) => { 
                console.log(i);
                i++;
            })
            .then((newContractInstance) => {
                console.log(newContractInstance.options.address) // instance with the new contract address
            });
                        
        });
        
    </script>

</body>
</html>
